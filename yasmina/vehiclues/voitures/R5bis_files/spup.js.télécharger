if(function(N){"use strict"
N.fn.bPopup=function(e,t){var a,o,n,i,s,r,l,d,u,c,p,f,m,b,v,y,h,g,P,U,w,L
return N.isFunction(e)&&(t=e,e=null),(a=N.extend({},N.fn.bPopup.defaults,e)).scrollBar||N("html").css("overflow","hidden"),o=this,n=N(document),i=window,s=N(i),r=I(),l=B(),d="__b-popup",u=/OS 6(_\d)+/i.test(navigator.userAgent),c=200,p=0,o.close=function(){S()},o.reposition=function(e){A(e)},o.each(function(){N(this).data("bPopup")||(O(a.onOpen),p=(s.data("bPopup")||0)+1,f=d+p+"__",b="auto"!==a.position[1],v="auto"!==a.position[0],y="fixed"===a.positionStyle,P=o.outerHeight(!0),U=o.outerWidth(!0),a.loadUrl?function(){switch(a.contentContainer=N(a.contentContainer||o),a.content){case"iframe":var e=N('<iframe class="b-iframe" '+a.iframeAttr+"></iframe>")
e.appendTo(a.contentContainer),P=o.outerHeight(!0),U=o.outerWidth(!0),C(),e.attr("src",a.loadUrl),O(a.loadCallback)
break
case"image":C(),N("<img />").load(function(){O(a.loadCallback),k(N(this))}).attr("src",a.loadUrl).hide().appendTo(a.contentContainer)
break
default:C(),N('<div class="b-ajax-wrapper"></div>').load(a.loadUrl,a.loadData,function(e,t,n){O(a.loadCallback,t),k(N(this))}).hide().appendTo(a.contentContainer)}}():C())})
function C(){a.modal&&N('<div class="b-modal '+f+'"></div>').css({backgroundColor:a.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:a.zIndex+p}).appendTo(a.appendTo).fadeTo(a.speed,a.opacity),z(),o.data("bPopup",a).data("id",f).css({left:"slideIn"==a.transition||"slideBack"==a.transition?"slideBack"==a.transition?n.scrollLeft()+l:-1*(g+U):M(!(!a.follow[0]&&v||y)),position:a.positionStyle||"absolute",top:"slideDown"==a.transition||"slideUp"==a.transition?"slideUp"==a.transition?n.scrollTop()+r:h+-1*P:T(!(!a.follow[1]&&b||y)),"z-index":a.zIndex+p+1}).each(function(){a.appending&&N(this).appendTo(a.appendTo)}),x(!0)}function S(){return a.modal&&N(".b-modal."+o.data("id")).fadeTo(a.speed,0,function(){N(this).remove()}),function(){a.scrollBar||N("html").css("overflow","auto")
N(".b-modal."+f).unbind("click"),n.unbind("keydown."+f),s.unbind("."+f).data("bPopup",0<s.data("bPopup")-1?s.data("bPopup")-1:null),o.undelegate(".bClose, ."+a.closeClass,"click."+f,S).data("bPopup",null)}(),clearTimeout(L),x(),!1}function A(e){r=I(),l=B(),(m=F())&&(clearTimeout(w),w=setTimeout(function(){z(),e=e||a.followSpeed,o.dequeue().each(function(){y?N(this).css({left:g,top:h}):N(this).animate({left:a.follow[0]?M(!0):"auto",top:a.follow[1]?T(!0):"auto"},e,a.followEasing)})},50))}function k(e){var t=e.width(),n=e.height(),i={}
a.contentContainer.css({height:n,width:t}),n>=o.height()&&(i.height=o.height()),t>=o.width()&&(i.width=o.width()),P=o.outerHeight(!0),U=o.outerWidth(!0),z(),a.contentContainer.css({height:"auto",width:"auto"}),i.left=M(!(!a.follow[0]&&v||y)),i.top=T(!(!a.follow[1]&&b||y)),o.animate(i,250,function(){e.show(),m=F()})}function x(t){switch(t?a.transition:a.transitionClose||a.transition){case"slideIn":e({left:t?M(!(!a.follow[0]&&v||y)):n.scrollLeft()-(U||o.outerWidth(!0))-c})
break
case"slideBack":e({left:t?M(!(!a.follow[0]&&v||y)):n.scrollLeft()+l+c})
break
case"slideDown":e({top:t?T(!(!a.follow[1]&&b||y)):n.scrollTop()-(P||o.outerHeight(!0))-c})
break
case"slideUp":e({top:t?T(!(!a.follow[1]&&b||y)):n.scrollTop()+r+c})
break
default:o.stop().fadeTo(a.speed,t?1:0,function(){_(t)})}function e(e){o.css({display:"block",opacity:1}).animate(e,a.speed,a.easing,function(){_(t)})}}function _(e){e?(s.data("bPopup",p),o.delegate(".bClose, ."+a.closeClass,"click."+f,S),a.modalClose&&N(".b-modal."+f).css("cursor","pointer").bind("click",S),u||!a.follow[0]&&!a.follow[1]||s.bind("scroll."+f,function(){m&&o.dequeue().animate({left:a.follow[0]?M(!y):"auto",top:a.follow[1]?T(!y):"auto"},a.followSpeed,a.followEasing)}).bind("resize."+f,function(){A()}),a.escClose&&n.bind("keydown."+f,function(e){27==e.which&&S()}),O(t),a.autoClose&&(L=setTimeout(S,a.autoClose))):(o.hide(),O(a.onClose),a.loadUrl&&(a.contentContainer.empty(),o.css({height:"auto",width:"auto"})))}function M(e){return e?g+n.scrollLeft():g}function T(e){return e?h+n.scrollTop():h}function O(e,t){N.isFunction(e)&&e.call(o,t)}function z(){h=b?a.position[1]:Math.max(0,(r-o.outerHeight(!0))/2-a.amsl),g=v?a.position[0]:(l-o.outerWidth(!0))/2,m=F()}function F(){return r>o.outerHeight(!0)&&l>o.outerWidth(!0)}function I(){return i.innerHeight||s.height()}function B(){return i.innerWidth||s.width()}},N.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}}(jQuery),!window.mfy)var mfy={jQuery:jQuery,onLoadStack:[],infoLevel:1,info:function(e,t){try{mfy.infoLevel&&window.console.info.apply(window.console,Array.isArray(e)?e:[e])}catch(e){}},ns:function(e){for(var t,n=window,i=e.split(".");void 0===n[t=i.shift()]&&(n[t]={}),n=n[t],i.length;);return n},define:function(e,t){var n=e.lastIndexOf("."),i=e.substring(0,n),a=e.substring(n+1),o=mfy.ns(i)
return o[a]=t(mfy.jQuery),o[a].prototype&&(o[a].prototype.className=a,o[a].prototype.fullClassName=e,o[a].prototype.namespace=o),t}}
mfy.define("mfy.lib.Observable",function(e){return function(){var r={},l=this
this.addListener=function(e,t){void 0===r[e]&&(r[e]=[]),r[e].push(t)},this.dispose=function(){l.removeAllListeners(),l=r=null},this.exposeMethods=function(n){e.each(["addListener","trigger","removeAllListeners","removeListener"],function(e,t){n[t]=function(){var e=Array.prototype.slice.call(arguments)
return"trigger"===t&&(1===e.length&&e.push(null),2===e.length&&e.push(n)),l[t].apply(l,e),n}}),n.getObservable=function(){return l}},this.removeAllListeners=function(e){return e?r[e]instanceof Array&&delete r[e]:r={},l},this.removeListener=function(e,t){var n,i,a
if(r[e]instanceof Array)for(i=0,a=(n=r[e]).length;i<a;i++)if(n[i]===t){n.splice(i,1)
break}return l},this.trigger=function(e,t,n){var i,a,o,s={type:e,target:n,data:t||{}}
if(mfy.info(["[event:"+n.fullClassName+"]["+e+"] "+(r[s.type]?r[s.type].length:0)+" callbacks déclarés, data = ",t]),r[s.type]instanceof Array)for(a=0,o=(i=r[s.type]).length;a<o;a++)i[a].call(l,s)
return l}}}),mfy.define("mfy.lib.Popin",function(l){var d,s={C:["confirmation","MfyLibPopin-msg-success"],E:["erreur","MfyLibPopin-msg-error"],I:["information","MfyLibPopin-msg-info"],Q:["demande de confirmation","MfyLibPopin-msg-info"]},r=function(e){var a,o,s,r;(new mfy.lib.Observable).exposeMethods(this),a=e||{},r=function(){var e=a.title||a.showCloseButton,t='<div class="MfyLibPopin '+(a.appendCssClass||"")+'">'+(e?'<div class="MfyLibPopin-head">'+(a.title?"<h4>"+a.title+"</h4>":"")+(a.showCloseButton?'<a class="b-close" href="#">&nbsp;</a>':"")+"</div>":"")+'<div class="MfyLibPopin-body"></div></div>',n=l(t)
return n.find(".MfyLibPopin-body").append(l(a.content)),n},(o=this).close=function(){return s&&s.close(),o},this.dispose=function(){d===o&&(d=null),o.getObservable().dispose(),s.remove(),a=o=s=null},this.getContainer=function(){return s},this.open=function(){var e=function(){var e=function(){o.trigger("close")},t=function(){setTimeout(function(){o.trigger("open")},50)},n=r(),i=l.extend({positionStyle:"fixed"},a.bPopup||{},{speed:0,onOpen:t,onClose:e})
s=l(n).appendTo(l("body")).bPopup(i),d=o}
return d?(d.addListener("close",e),d.close()):e(),o},this.addListener("close",function(){o.dispose()})}
return r.getMsgBox=function(e,t,n){var i,a,o='<span class="MfyLibPopin-icon"></span><p>'+t+"</p>"
return 0<n&&(o+='<div class="MfyLibPopin-btns">',(1&n||4&n)&&(o+='<button class="MfyLibPopin-btn MfyLibPopin-'+(!0&n?"btn-continue":"btn-confirm")+'" data-mfy-popin-event="ok">continuer</button>'),2&n&&(o+='<button class="MfyLibPopin-btn MfyLibPopin-btn-cancel" data-mfy-popin-event="cancel">annuler</button>'),8&n&&(o+='<button class="MfyLibPopin-btn MfyLibPopin-btn-login" data-mfy-popin-event="ok">identifiez-vous</button>'),o+='<div class="MfyLibPopin-btns-fix"></div></div>'),i=l(o),a=new r({appendCssClass:"MfyLibPopin-msg "+s[e][1],title:s[e][0],showCloseButton:!0,content:i}),i.find("[data-mfy-popin-event]").on("click",function(e){a.trigger(l(this).data("mfyPopinEvent")),a.close()}),a},r}),mfy.define("mfy.lib.SPUP.component.CommError",function(e){return function(){mfy.lib.Popin.getMsgBox("E","Une erreur de communication avec le serveur est survenue. Veuillez réessayer plus tard",2).open()}}),mfy.define("mfy.lib.SPUP.component.CreateForm",function(v){return function(){var i,a,o,e,t,n,s,r,l,d,u,c,p,f,m,b;(new mfy.lib.Observable).exposeMethods(this),a=i=null,o=new mfy.lib.SPUP.component.User,r=s=n=t=e=null,l={next:"none"},u='<form id="spupCreatePseudo" class="spup-form"><div class="spup-fieldset"><label for="pseudo">mon pseudo</label><input type="text" name="pseudo" id="spup-pseudo" /><span class="spup-bubble">Ce pseudo n\'est pas disponible</span></div><div class="spup-fieldset"><label for="email">mon mail</label><input type="email" name="email" id="spup-email" /><span class="spup-bubble">Cette adresse n\'est pas disponible</span></div><div name="CGU" class="spup-fieldset"><input type="checkbox" name="checkTerms" id="spup-checkTerms" /> j&#39ai lu et j&#39accepte les <span class="spup-highlight"><strong>conditions générales d&#39utilisation<strong></span></div><div class="MfyLibPopin-btns"><input class="MfyLibPopin-btn" disabled="disabled" type="submit" value="valider" /><div class="MfyLibPopin-btns-fix"></div></div></form>',c=function(){o.removeListener("read",b),d.trigger("closed",l)},p=function(){i=new mfy.lib.Popin({title:"Réservez votre pseudo gratuit",content:u,showCloseButton:!0,appendCssClass:"MfyLibPopin-msg"}).open().addListener("close",c),e=v("#spupCreatePseudo"),t=v("#spup-pseudo",e),n=v("#spup-email",e),s=v("#spup-checkTerms",e),r=v("input[type=submit]",e),(a=new mfy.lib.SPUP.component.Validator(t,n,r)).addCheck(function(){return s.prop("checked")},!1),e.delegate('[name="CGU"] span',"click",function(e){f(),l.next="terms",i.close(),e.preventDefault()}),t.on("keyup",a.check),n.on("keyup",a.check),s.on("change",a.check),e.delegate(e,"submit",m)},f=function(){o.setPseudo(t.val()),o.setMail(n.val()),o.setTerms(s.prop("checked"))},m=function(e){var n=function(e){var t=function(){i.close(),o.removeListener("created",t)}
a.removeListener("availability",n),!0===e.data.name&&!0===e.data.mail&&(o.addListener("created",t),o.write())}
e.preventDefault(),f(),a.addListener("availability",n),a.checkAvailability()},b=function(){if(o.removeAllListeners(),!1===o.isNew())mfy.lib.Popin.getMsgBox("E","Vous possédez déjà un pseudo, il est impossible d'en créer un nouveau",2).open().addListener("close",c)
else{var e=o.getPseudo()
p(),""!==e&&(t.val(e),n.val(o.getMail()),o.getTerms()&&s.prop("checked","checked"))}},(d=this).display=function(){o.addListener("read",b),o.addListener("unauthorized",function(){o.removeAllListeners(),l.next="authorize",c()}),o.read()},this.display()}}),mfy.define("mfy.lib.SPUP.component.Libraries",function(n){return function(){var t,s,e;(new mfy.lib.Observable).exposeMethods(this),s=function(e){var t=mfy.lib.SPUP.component.Libraries.data
return{id:t[e].id,name:t[e].name,desc:t[e].description}},e=function(e){mfy.lib.SPUP.component.Libraries.data=e,t.trigger("read")},(t=this).getAll=function(){return mfy.lib.SPUP.component.Libraries.data},this.getById=function(e){var t,n,i,a=null,o=mfy.lib.SPUP.component.Libraries.data
if(null!==o)for(t=0,n=o.length,i=!1;t<n&&!1===i;t++)o[t].id===e&&(a=o[t],i=!0)
return a},this.getByName=function(e){var t,n,i,a=null,o=mfy.lib.SPUP.component.Libraries.data
if(null!==o)for(t=0,n=o.length,i=!1;t<n&&!1===i;t++)o[t].name===e&&(a=s(t),i=!0)
return a},this.read=function(){null===mfy.lib.SPUP.component.Libraries.data?n.ajax({url:mfy.SPUP.apiUrl+"libraries",xhrFields:{withCredentials:!0},crossDomain:!0,type:"get",dataType:"json",async:!0,success:e,error:function(e){403===e.status?t.trigger("unauthorized"):new mfy.lib.SPUP.component.CommError}}):t.trigger("read")}}}),mfy.lib.SPUP.component.Libraries.data=null,mfy.define("mfy.lib.SPUP.component.Authorize",function(e){return function(e){var t,n;(new mfy.lib.Observable).exposeMethods(this),t=this,n=!1,i=e,a=function(){!1===n&&t.trigger("cancelled")},o=function(){setTimeout(a,200)},s=function(){n=!0,"object"==typeof o_idzone&&"string"==typeof o_idzone.IDENT_FORM_URL?window.location.replace(o_idzone.IDENT_FORM_URL+"/?return_url="+window.location.href.split("#")[0]+"#"+i+"Spup"):(n=!1,mfy.lib.Popin.getMsgBox("E","Connexion impossible",2).open())},n=!1,mfy.lib.Popin.getMsgBox("I","Vous allez &ecirc;tre redirig&eacute;(e) vers l'interface de connexion. <br />Si vous n'avez pas de pseudo, vous aurez la possibilit&eacute; d'en choisir un.",8).addListener("ok",s).addListener("close",o).open()
var i,a,o,s}}),mfy.define("mfy.lib.SPUP.component.User",function(l){return function(){var o,s,r;(new mfy.lib.Observable).exposeMethods(this),s=function(){var e=mfy.lib.SPUP.component.User.data
return null===e&&(e={}),e},r=function(e){mfy.lib.SPUP.component.User.data=e},(o=this).delete=function(){var e=function(e){mfy.lib.SPUP.component.User.data=null,o.trigger("deleted")},t=function(){new mfy.lib.SPUP.component.CommError}
null!==mfy.lib.SPUP.component.User.data?l.ajax({url:mfy.SPUP.apiUrl+"pseudos",xhrFields:{withCredentials:!0},crossDomain:!0,type:"delete",dataType:"json",async:!0,success:e,error:t}):o.trigger("deleted")},this.getAvatar=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.avatar["142x142"]},this.getAvatars=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?{}:e.avatar},this.getId=function(){var e=mfy.lib.SPUP.component.User.data
return null===e||void 0===e.id?-1:e.id},this.getLibrary=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.library},this.getMail=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.email},this.getOriginalMail=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.originalEmail},this.getOriginalPseudo=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.originalName},this.getPseudo=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?"":e.name},this.getStatus=function(){var e=mfy.lib.SPUP.component.User.data
return null===e?{global:"New",pseudo:"New",avatar:"New",isCancellable:!1}:e.status},this.getTerms=function(){var e=mfy.lib.SPUP.component.User.data
return e&&!0===e.terms},this.isAvatarUpdated=function(){return mfy.lib.SPUP.component.User.data.avatar.dirty},this.isNew=function(){var e=mfy.lib.SPUP.component.User.data
return null===e||void 0===e.id},this.isUploading=function(){var e=s()
return null!==e&&null!==e.upload},this.read=function(){var e=function(e){if(void 0!==e.id){mfy.lib.SPUP.component.User.data=e
var t=mfy.lib.SPUP.component.User.data
t.terms=!0,t.dirty=!1,t.upload=null,t.avatar.dirty=!1,t.originalName=e.name,t.originalEmail=e.email,t.originalLibrary=e.library,t.originalAvatar=t.avatar["142x142"],t.originalAvatarStatus=t.status.avatar}o.trigger("read")},t=function(e,t){"error"===t&&404===e.status?o.trigger("read"):403===e.status?o.trigger("unauthorized"):new mfy.lib.SPUP.component.CommError}
null===mfy.lib.SPUP.component.User.data?l.ajax({url:mfy.SPUP.apiUrl+"pseudos",xhrFields:{withCredentials:!0},crossDomain:!0,type:"get",dataType:"json",async:!0,success:e,error:t}):o.trigger("read")},this.resetUpload=function(){var e=mfy.lib.SPUP.component.User.data
e.avatar.dirty=!1,e.library=e.originalLibrary,e.avatar["142x142"]=e.originalAvatar,e.status.avatar=e.originalAvatarStatus,e.upload=null,r(e)},this.setAvatar=function(e){var t=s()
t.avatar&&e===t.avatar||(t.avatar["142x142"]=e,t.status.avatar="Ok",t.avatar.dirty=!0,t.upload&&(t.upload=null),t.dirty=!0,r(t))},this.setAvatarToUpload=function(e){var t,n,i,a,o=s()
if(!o.upload){for(t=o.avatar["142x142"].split("/"),n="",o.status.avatar="New",o.avatar.dirty=!0,i=0,a=t.length-2;i<a;i++)0<i&&(n+="/"),n+=t[i]
o.avatar["142x142"]=n+"/default/default.jpg"}o.upload=e,o.dirty=!0,r(o)},this.setLibrary=function(e){var t=s()
t.library&&e===t.library||(t.library=e,t.dirty=!0,r(t))},this.setMail=function(e){var t=s()
t.email&&e===t.email||(t.email=e,t.dirty=!0,r(t))},this.setPseudo=function(e){var t=s()
t.name&&e===t.name||(t.name=e,t.dirty=!0,r(t))},this.setTerms=function(e){mfy.lib.SPUP.component.User.data.terms=!0===e},this.write=function(){var e,t,n,i=function(e,t,n){if(200===n.status||201===n.status){var i=mfy.lib.SPUP.component.User.data
i.id=e.id,i.avatar=e.avatar,i.library=e.library,i.status=e.status}mfy.lib.SPUP.component.User.data.dirty=!1,o.trigger("created")},a=function(e){o.trigger("creation_failed",{status:e.status})}
mfy.lib.SPUP.component.User.data.dirty&&(e=mfy.lib.SPUP.component.User.data,t=new FormData,n=o.isUploading(),t.append("name",e.name),t.append("email",e.email),o.isNew()||(t.append("library",e.library),n?t.append("userAvatarFile",e.upload):t.append("avatar",e.avatar["142x142"])),l.ajax({url:mfy.SPUP.apiUrl+"pseudos",xhrFields:{withCredentials:!0},crossDomain:!0,type:"post",dataType:"json",data:t,processData:!1,contentType:!1}).done(i).fail(a))}}}),mfy.lib.SPUP.component.User.data=null,mfy.define("mfy.lib.SPUP.component.ManageForm",function(w){return function(){var a,s,r,o,l,i,d,u,c,p,e,t,f,m,n,b,v,y,h,g,P,U;(new mfy.lib.Observable).exposeMethods(this),s=a=null,r=new mfy.lib.SPUP.component.User,o=new mfy.lib.SPUP.component.Libraries,c=u=d=i=l=null,p={next:"none"},t='<div class="spup-actions"><span>contactez-nous</span><span>CGU</span></div><form id="spupManagePseudo" class="spup-form" onsubmit="return false;"><div class="spup-fieldset"><label for="pseudo"><div id="spup-pseudoStatus" class="spup-led"></div>mon pseudo</label><input type="text" name="pseudo" id="spup-pseudo" /><span class="spup-bubble">Ce pseudo n\'est pas disponible</span></div><div class="spup-fieldset"><label for="email">mon mail</label><input type="email" name="email" id="spup-email" /><span class="spup-bubble">Cette adresse n\'est pas disponible</span></div><div class="spup-fieldset"><label for="avatar"><div id="spup-avatarStatus" class="spup-led"></div>mon avatar</label><select name="library" id="spup-library"><option value="undefined">Ajouter depuis ...</option></select></div><div><div name="avatar" id="spup-avatar"></div><div id="spup-mngHelp">Depuis notre bibliothèque d\'images ou votre ordinateur, choisissez l\'avatar qui vous ressemble<br /><br /></div></div><div class="MfyLibPopin-btns"><input class="MfyLibPopin-btn" type="button" value="annuler" /><input class="MfyLibPopin-btn" type="submit" value="valider" /><div class="MfyLibPopin-btns-fix"></div></div></form>',f=function(){r.removeAllListeners(),o.removeAllListeners(),e.trigger("closed",p)},m=function(){a=new mfy.lib.Popin({title:"Gérez votre pseudo",content:t,showCloseButton:!0,appendCssClass:"MfyLibPopin-msg"}).open().addListener("close",f),l=w("#spupManagePseudo"),i=w("#spup-pseudo",l),d=w("#spup-email",l),u=w("#spup-library",l),c=w("#spup-avatar",l),(s=new mfy.lib.SPUP.component.Validator(i,d,w("input[type=submit]",l))).addCheck(r.isAvatarUpdated,!0),w("div.spup-actions span").first().click(n),w("div.spup-actions span:nth-child(2)").click(b),i.on("keyup",s.check),d.on("keyup",s.check),l.delegate(l,"submit",h),w("input[type=button]",l).click(a.close)},n=function(){y(),p.next="contact",a.close()},b=function(){y(),p.next="terms",a.close()},v=function(){var e=r.getLibrary()
""!==e&&null!==o&&(l_oLib=o.getByName(e),null!==l_oLib&&w("option[value="+l_oLib.id+"]",u).prop("selected",!0),-1===w.inArray(r.getStatus().avatar,["New","Sent"])||r.isUploading()?u.on("change",function(e){var t=u.val()
e.preventDefault(),"undefined"!==t&&(p={next:"selectAvatar",libId:t},a.close())}):u.prop("disabled","disabled"))},y=function(){r.setPseudo(i.val()),r.setMail(d.val())},h=function(e){var i=function(e){var t=function(){a.close(),r.removeListener("created",t)},n=function(e){r.removeListener("creation_failed",n),413===e.data.status?(r.resetUpload(),p={next:"error",type:"E",msg:"L'image fournie ne respecte pas les conditions. Veuillez en sélectionner une autre",buttons:1},a.close()):(a.close(),new mfy.lib.SPUP.component.CommError)}
s.removeListener("availability",i),!0===e.data.name&&!0===e.data.mail&&(r.addListener("created",t),r.addListener("creation_failed",n),r.write(a.close))}
e.preventDefault(),y(),s.addListener("availability",i),s.checkAvailability()},g=function(){var e=function(){if(null!==a){clearInterval(i)
for(var e=0,t=n.length;e<t;e++)u.append(new Option(n[e].description,n[e].id))
o.removeAllListeners(),v()}},n=o.getAll(),i=setInterval(e,100)},P=function(){var o,e=function(){y(),p={next:"selectAvatar",libId:u.val()},a.close()},t=function(){y(),p.next="delUser",a.close()},n=function(e){var t=w("#spup-"+e+"Status",l),n=e[0].toUpperCase()+e.substring(1),i="green",a=" valide";-1!==w.inArray(o[e],["New","Sent"])?(i="yellow",a=" en cours de modération, modification non autorisée"):"Ko"===o[e]?(i="red",a=" invalide"):-1===w.inArray(o[e],["Ok","Illicit"])||o.isCancellable||"pseudo"!==e||(a=" valide, non modifiable car trop récent"),t.addClass("spup-led-"+i),t.attr("title",n+a)}
r.removeAllListeners(),!0===r.isNew()?mfy.lib.Popin.getMsgBox("E","Vous ne possédez pas encore de pseudo",2).open().addListener("close",f):(o=r.getStatus(),m(),n("pseudo"),i.val(r.getPseudo()),(-1!==w.inArray(o.pseudo,["New","Sent"])||-1!==w.inArray(o.pseudo,["Ok","Illicit"])&&!o.isCancellable)&&i.prop("disabled","disabled"),d.val(r.getMail()),n("avatar"),c.append('<img src="'+r.getAvatar()+'" alt="avatar" />'),r.isUploading()?c.append('<div class="spup-overlay">Téléchargement en cours</div>'):-1!==w.inArray(o.avatar,["New","Sent"])?c.append('<div class="spup-overlay">Modération en cours</div>'):(l_oImg=w("img",c),l_oImg.addClass("clickable"),l_oImg.click(e)),s.check(),v(),o.isCancellable&&-1===w.inArray(o.global,["New","Sent"])&&(w("div.spup-actions").append("<span>résiliez votre pseudo</span>"),w("div.spup-actions span:nth-child(3)").click(t)))},U=function(e){r.removeAllListeners(),o.removeAllListeners(),p.next="authorize",f()},(e=this).display=function(){r.addListener("read",P),r.addListener("unauthorized",U),r.read(),o.addListener("read",g),o.addListener("unauthorized",U),o.read()},this.display()}}),mfy.define("mfy.lib.SPUP.component.Validator",function(y){return function(e,t,n){var i,a,o,s,r,l,d,u,c,p,f,m,b,v;(new mfy.lib.Observable).exposeMethods(this),a=e,o=t,s=n,r=null,l=!1,u=d="",c={},p=[],f=[],m=function(){var e=function(e){var t=function(){n.fadeOut(1e3)},n=y("span",e.parent())
n.css("visibility","visible"),setTimeout(t,2e3)}
!0===c.pseudoChecked&&!0===c.mailChecked&&(c.pseudoOk&&c.mailOk||(s.attr("disabled","disabled"),c.pseudoOk||e(a),c.mailOk||e(o)),i.trigger("availability",{name:c.pseudoOk,mail:c.mailOk}))},b=function(e){var t=function(e){c.pseudoOk=404===e.status,c.pseudoChecked=!0,c.pseudoOk||(p.push(e.testedValue),v("pseudo")),m()},n="name"===e?a.val():o.val(),i="name"===e?d:u
n!==i?"name"===e?y.ajax({url:mfy.SPUP.apiUrl+"existence?name="+n,xhrFields:{withCredentials:!0},crossDomain:!0,type:"get",dataType:"text",async:!0,complete:t}).testedValue=n:(c.mailOk=!0,c.mailChecked=!0,m()):("name"===e?(c.pseudoChecked=!0,c.pseudoOk=!0):(c.mailChecked=!0,c.mailOk=!0),m())},v=function(e){var t="pseudo"===e?p:f,n="pseudo"===e?a:o,i="^"
for(l_nI=0,l_nCnt=t.length;l_nI<l_nCnt;l_nI++)i+="(?!"+t[l_nI]+"$)"
i+="pseudo"===e?"[a-zA-Z_[[\\]][-0-9a-zA-Z_\\[\\]]{1,19}$":".*$",n.attr("pattern",i)},(i=this).addCheck=function(e,t){r=e,l=t},this.check=function(){var e=("disabled"===a.attr("disabled")||a.is(":valid"))&&o.is(":valid")
e&&r&&(e=l?e||r():e&&r()),e?s.removeAttr("disabled"):s.attr("disabled","disabled")},this.checkAvailability=function(){if(""===d){var e=new mfy.lib.SPUP.component.User
d=e.getOriginalPseudo(),u=e.getOriginalMail()}c={pseudoOk:!1,pseudoChecked:!1,mailOk:!1,mailChecked:!1},b("mail"),b("name")},a.prop("required",!0),a.attr("title","Veuillez saisir un pseudo valide (de 2 à 20 caractères alphanumériques ou -)"),v("pseudo"),o.prop("required",!0),v("mail")}}),mfy.define("mfy.lib.SPUP.component.Avatars",function(o){return function(e){var t,i,n,a;(new mfy.lib.Observable).exposeMethods(this),t=e,i=null,a=function(e){i=e,n.trigger("read")},(n=this).getAll=function(){var e,t,n=[]
if(null!==i)for(e=0,t=i.length;e<t;e++)n[e]={id:i[e].id,url:i[e].url}
return n},this.getCount=function(){return i.length},this.read=function(){null===i?o.ajax({url:mfy.SPUP.apiUrl+"libraries/"+t+"/avatars?limit=200",xhrFields:{withCredentials:!0},crossDomain:!0,type:"get",dataType:"json",async:!0,success:a,error:function(){new mfy.lib.SPUP.component.CommError}}):n.trigger("read")}}}),mfy.define("mfy.lib.SPUP.component.SelectAvatarForm",function(y){return function(e,t){var i,n,a,o,s,r,l,d,u,c,p,f,m,b,v;(new mfy.lib.Observable).exposeMethods(this),i=new mfy.lib.SPUP.component.User,a=e,o=t,d=l=r=s=n=null,u=-1,c=this,p='<form id="spupSelectAvatar" class="spup-form"><ul></ul><div class="MfyLibPopin-btns"><input class="MfyLibPopin-btn" type="button" value="annuler" /><input class="MfyLibPopin-btn" type="submit" disabled="disabled" value="valider" /><div class="MfyLibPopin-btns-fix"></div></div></form>',f=function(e){var t=parseInt(y(e.target).closest("li").prop("id").substr(12)),n=-1!==u
u=t===u?-1:t,n&&(y("li div",l).remove(),d.attr("disabled","disabled")),-1!==u&&(y("li",l).not("#spup-avatar-"+u).append('<div class="spup-overlay"></div>'),d.removeAttr("disabled"))},m=function(){n=new mfy.lib.Popin({title:"Sélectionnez votre avatar",content:p,showCloseButton:!0,appendCssClass:"spup-avatarsList"}).open().addListener("close",function(){r.removeAllListeners(),c.trigger("closed")}),s=y("#spupSelectAvatar"),l=y("ul",s),d=y("input[type=submit]",s),null===r&&(r=new mfy.lib.SPUP.component.Avatars(a)),r.addListener("read",v),r.read(),s.delegate(s,"submit",b),y("input[type=button]",s).on("click",function(){n.close()})},b=function(e){var t=new mfy.lib.SPUP.component.Libraries
e.preventDefault(),i.setLibrary(t.getById(a).name),i.setAvatar(y("#spup-avatar-"+u+" img").prop("src")),n.close()},v=function(){var e,t=r.getAll(),n=t.length
for(e=0;e<n;e++)l.append('<li id="spup-avatar-'+t[e].id+'"><img src="'+t[e].url+'" /></li>')
r.removeAllListeners(),l.delegate("li","click",f),o===i.getLibrary()&&y('img[src="'+i.getAvatar()+'"]',l).click()},m()}}),mfy.define("mfy.lib.SPUP.component.UploadAvatarForm",function(c){return function(){var n,i,e,t,a,o,s,r,l,d,u;(new mfy.lib.Observable).exposeMethods(this),o=a=t=e=i=n=null,s=this,r='<form id="spupUploadAvatar" class="spup-form">Votre image doit avoir les caractéristiques suivantes :<ul><li>Format : JPG, GIF, GIF animé ou PNG</li><li>Dimensions maximales : 500 x 500 pixels</li><li>Poids maximal : 150 Ko</li></ul><div class="spup-upload"><input type="file" id="spup-upload" /><input type="button" id="spup-upload-btn" value="Parcourir..." class="MfyLibPopin-btn" /><span id="spup-upload-src"></span></div><div class="MfyLibPopin-btns"><input class="MfyLibPopin-btn" type="button" value="annuler" /><input class="MfyLibPopin-btn" type="submit" disabled="disabled" value="valider" /><div class="MfyLibPopin-btns-fix"></div></div></form>',l=function(){n=new mfy.lib.Popin({title:"Téléchargez votre avatar",content:r,showCloseButton:!0}).open().addListener("close",function(){s.trigger("closed")}),e=c("#spupUploadAvatar"),t=c("#spup-upload",e),a=c("#spup-upload-src",e),o=c("input[type=submit]"),d(),t.on("change",d),c("#spup-upload-btn").click(function(){t.click()}),c(".MfyLibPopin-btns input[type=button]",e).click(function(){n.close()}),e.delegate(e,"submit",u)},d=function(e){e&&1===e.target.files.length?(i=e.target.files[0],a.html(i.name),o.removeAttr("disabled")):(a.html("Aucun fichier sélectionné"),o.attr("disabled","disabled"))},u=function(e){var t=new mfy.lib.SPUP.component.User
e.preventDefault(),t.setLibrary("user"),t.setAvatarToUpload(i),n.close()},l()}}),mfy.define("mfy.SPUP",function($){var exports=function(){var m_oThis,m_sLastForm,connect,create,displayTerms,execNextAction,fctCallback,manage,reopen,selectAvatarClosed,sendPublicEvent,l_sSrc,l_nPos,l_sHash,l_sCmd;(new mfy.lib.Observable).exposeMethods(this),m_oThis=this,m_sLastForm="",m_sBaseUrl="",m_oForm=null,m_sCurrentAction="none",m_bAfterConnection=!1,connect=function(){var e=function(){m_oThis.trigger("cancelled"),m_sCurrentAction="none"}
m_bAfterConnection?(mfy.lib.Popin.getMsgBox("E","Vous n'avez pas &eacute;t&eacute; reconnu par le syst&egrave;me d'authentification",2).open(),m_sCurrentAction="none"):new mfy.lib.SPUP.component.Authorize(m_sCurrentAction).addListener("cancelled",e)},create=function(){var t,e=function(e){fctCallback(t,e,"created")},n=!1
return"none"===m_sCurrentAction&&(m_sCurrentAction="create",n=!0,m_sLastForm="create",(t=new mfy.lib.SPUP.component.CreateForm).addListener("closed",e)),n},displayTerms=function(){new mfy.lib.Popin({showCloseButton:!0,appendCssClass:"spup-terms",bPopup:{content:"iframe",loadUrl:m_sBaseUrl+"terms.html",iframeAttr:""}}).open().addListener("close",reopen)},execNextAction=function(e){var t,n
switch(e.data.next){case"authorize":connect()
break
case"contact":new mfy.lib.Popin({showCloseButton:!0,appendCssClass:"spup-contact",bPopup:{content:"iframe",loadUrl:"https://formulaires.services.orange.fr/124",iframeAttr:""}}).open().addListener("close",reopen)
break
case"delUser":t=function(){var e=function(e){fctCallback(t,e,"managed")},t=new mfy.lib.SPUP.component.User
t.addListener("deleted",e),t.delete()},mfy.lib.Popin.getMsgBox("Q","Vous avez demand&eacute; la r&eacute;siliation de votre pseudo.<br />Si vous confirmez, votre pseudo sera d&eacute;finitivement supprim&eacute;.",6).addListener("cancel",reopen).addListener("ok",t).open()
break
case"error":mfy.lib.Popin.getMsgBox(e.data.type,e.data.msg,e.data.buttons).addListener("ok",reopen).open()
break
case"selectAvatar":null!==(n=(new mfy.lib.SPUP.component.Libraries).getById(e.data.libId))&&("client"===n.origin?m_oForm=new mfy.lib.SPUP.component.UploadAvatarForm:m_oForm=new mfy.lib.SPUP.component.SelectAvatarForm(n.id,n.name),m_oForm.addListener("closed",selectAvatarClosed))
break
case"terms":displayTerms()}},fctCallback=function(e,t,n){e.removeAllListeners(),void 0===t.data.next||"none"===t.data.next?(sendPublicEvent(n),m_sCurrentAction="none"):execNextAction(t)},manage=function(){var t,e=function(e){fctCallback(t,e,"managed")},n=function(){t=null,m_sCurrentAction="none",manage()},i=!1
return"none"===m_sCurrentAction&&(m_sCurrentAction="manage",i=!0,m_sLastForm="manage",(t=new mfy.lib.SPUP.component.ManageForm).addListener("closed",e),t.addListener("uploadFailed",n)),i},reopen=function(){m_sCurrentAction="none","create"===m_sLastForm?create():"manage"===m_sLastForm&&manage()},selectAvatarClosed=function(){reopen(),m_oForm.removeAllListeners(),m_oForm=null},sendPublicEvent=function(e){var t=new mfy.lib.SPUP.component.User
m_oThis.trigger(e,{id:t.getId(),name:t.getPseudo(),avatar:t.getAvatars(),email:t.getMail(),status:t.getStatus()})},this.create=function(){return create()},this.get=function(e){var t,n=function(e){fctCallback(t,e,"read")},i=function(){t.removeAllListeners(),void 0!==e&&!0===e?(m_sCurrentAction="none",sendPublicEvent("read")):connect()},a=!1
return"none"===m_sCurrentAction&&(m_sCurrentAction="get",a=!0,(t=new mfy.lib.SPUP.component.User).addListener("read",n),t.addListener("unauthorized",i),t.read()),a},this.getCurrentAction=function(){return m_sCurrentAction},this.manage=function(){return manage()},this.terms=function(){m_sLastForm="",displayTerms()},l_sSrc=$($('script[src$="spup.js"]')).attr("src"),l_nPos=l_sSrc.indexOf("//"),-1===l_nPos&&(l_sSrc=window.location.toString(),l_nPos=l_sSrc.indexOf("//")),l_sSrc=l_sSrc.substring(l_nPos+2),m_sBaseUrl="//"+l_sSrc.substring(0,l_sSrc.indexOf("/")).replace("orange.fr","woopic.com")+"/",mfy.SPUP.apiUrl=m_sBaseUrl.replace("woopic.com","orange.fr")+"nc/api/v5/",l_sHash=window.location.hash,l_sHash&&"Spup"===l_sHash.slice(-4)&&(l_sCmd=l_sHash.slice(1,-4),-1!==$.inArray(l_sCmd,["create","get","manage"])&&(m_bAfterConnection=!0,eval("this."+l_sCmd+"()")),window.location.replace(window.location.href.split("#")[0]+"#"))}
return $(document).ready(function(e){window.oSpup=new exports,document.domain="orange.fr",e(document).trigger("mfy.SPUP.ready")}),exports})
